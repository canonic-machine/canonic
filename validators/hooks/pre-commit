#!/bin/bash
#
# CANONIC pre-commit hook
# Enforces LANGUAGE.md before commits enter LEDGER
#
# Primitives: LEDGER â†’ { CANON, VOCAB, README, COVERAGE, APPSTORE }
#

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(git rev-parse --show-toplevel)"

echo "=== CANONIC Pre-Commit Validation ==="
echo ""

# Run VaaS validator
if command -v python3 &> /dev/null; then
    CANONIC_ROOT="$REPO_ROOT" python3 "$REPO_ROOT/validators/vaas.py"
    EXIT_CODE=$?

    if [ $EXIT_CODE -ne 0 ]; then
        echo ""
        echo "COMMIT BLOCKED: LANGUAGE.md violations detected"
        echo ""
        echo "Fix violations and try again."
        exit 1
    fi
else
    echo "WARNING: python3 not found, skipping VaaS validation"
fi

echo ""
echo "COMMIT ALLOWED: All validations passed"
exit 0
